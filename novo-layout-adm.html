<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: #272d2a;
        }

        @font-face {
            font-family: 'NaruSans-Bold';
            src: url(/font/NaruSans-Bold.ttf) format('truetype');
            font-weight: bold;
        }

        @font-face {
            font-family: 'NaruSans-Regular';
            src: url(/font/NaruSans-Regular.ttf) format('truetype');
            font-weight: normal;
        }

        .topbar {
            background-color: #108e64;
            display: grid; /* center nav independent of logo width */
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            padding: 12px 16px;
        }

        .topbar .logo { justify-self: start; }
        .topbar .logo img { width: 190px; position: relative; margin: 0; }

        .user-info {
            align-content: center;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-self: center; /* center the buttons block */
        }

        .user-info button {
            background-color: #108e64;
            padding: 12px 30px;
            color: white;
            border: none;
            margin-left: 16px;
            cursor: pointer;
            font-size: 14px;
            font-family: 'NaruSans-Bold', sans-serif;
            font-size: 18px;
        }

        .user-info button:active {
            background-color: #0c6749;
            padding: 12px 30px;
            border-radius: 0px 10px 10px 10px;
        }

        .second-header {
            background-color: white;
        }

        .second-header {
            display: grid;
            grid-template-columns: auto 1fr; /* title + actions row */
            align-items: center;
            gap: 16px;
            padding: 10px 20px;
        }

        :root { --action-height: 56px; }

        .actions-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 18px;
        }

        .action-button {
            width: 100%;
            height: var(--action-height);
            background-color: #108e64;
            color: white;
            border: none;
            cursor: pointer;
            font-family: 'NaruSans-Regular', sans-serif;
            font-size: 12px;
            border-radius: 10px;
        }

        .btn-upload {
            width: 100%;
            height: var(--action-height);
            border: 2px dashed #108e64;
            border-radius: 10px;
            background-color: #f3faf7;
            color: #108e64;
            cursor: pointer;
            font-family: 'NaruSans-Regular', sans-serif;
            font-size: 12px;
        }

        .comentario input {
            border: none;
            background-color: rgb(221, 221, 221);
            border-radius: 10px;
            padding: 5px 10px;
            font-family: 'NaruSans-Regular', sans-serif;
            font-size: 12px;
            width: 200px; /* default; overridden in actions row */
            height: 40px; /* default; overridden in actions row */
        }

        .actions-row .comentario input {
            width: 100%;
            height: var(--action-height);
            background-color: #c8d4cf;
        }

        .side-bar {
            position: relative; /* below headers in normal flow */
            width: 280px;
            background: #4a544f; /* requested background */
            border-radius: 0 12px 12px 0px; /* rounded corners */
            padding: 12px 16px;
        }

        .sidebar-header {
            color: #e8f5f0;
            font-family: 'NaruSans-Bold', sans-serif;
            font-size: 18px;
            margin-bottom: 12px;
        }

        .sidebar-search {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .sidebar-search input[type="text"] {
            width: 100%;
            height: 36px;
            border-radius: 10px;
            border: none;
            background: #39413d;
            padding: 6px 10px;
            font-family: 'NaruSans-Regular', sans-serif;
            font-size: 12px;
            outline: none;
            color: white;
        }

        #lojas-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 6px;
        }

        #lojas-list li {
            color: #e8f5f0;
            font-family: 'NaruSans-Regular', sans-serif;
            font-size: 13px;
            padding: 6px 8px;
            border-radius: 8px;
            transition: background-color 0.15s ease-in-out;
            cursor: default;
        }

        #lojas-list li:hover {
            background: #2a322f;
        }
    </style>
    <header class="topbar">
        <div class="logo">
            <img src="/logo/PRICEBOARD LOGO.svg" alt="Logo-Tags" border="0" width="120px">
        </div>
        <div class="user-info">
            <button class="tags-preview">Tag's</button>
            <button class="tags-preview">PDF's</button>
            <button class="tags-preview">Def. Margem</button>
            <button class="tags-preview">Etiquetas</button>
        </div>
    </header>
    <section class="second-header">
        <p style="font-family: 'NaruSans-Bold', sans-serif; font-size: 20px; color: #0c6749;">Novo Upload</p>
        <div class="actions-row">
            <button class="btn-upload">Selecione ou arraste<br>um arquivo aqui</button>
            <button class="action-button">Selecionar<br>a data</button>
            <button class="action-button">Selecionar<br>o cluster</button>
            <button class="action-button">Selecionar<br>a ação</button>
            <div class="comentario"><input type="text" placeholder="Comentário"></div>
        </div>
    </section>

    <nav class="side-bar">
        <div class="sidebar-header">Lojas</div>
        <div class="sidebar-search">
            <input id="search-lojas" type="text" placeholder="Pesquisar lojas" aria-label="Pesquisar lojas">
        </div>
        <ul id="lojas-list"></ul>
    </nav>

    <script>
        // Utility: normalize strings for accent-insensitive comparisons
        function normalizeString(str) {
            return str
                .toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '');
        }

        // Map of raw keys to human-readable names with accents and spacing
        const LOJA_NAME_MAP = {
            aguamineral: 'Água Mineral',
            araruama1: 'Araruama 1',
            araruama2: 'Araruama 2',
            arsenal: 'Arsenal',
            bacaxa1: 'Bacaxá 1',
            bacaxa2: 'Bacaxá 2',
            botafogo: 'Botafogo',
            buzios: 'Búzios',
            cabofrio1: 'Cabo Frio 1',
            cabofrio2: 'Cabo Frio 2',
            casimirodeabreu: 'Casimiro de Abreu',
            colubande: 'Colubandê',
            copacabana: 'Copacabana',
            cordeirinho: 'Cordeirinho',
            iguaba: 'Iguaba',
            inoa: 'Inoã',
            itaborai: 'Itaboraí',
            jardinmcatarina: 'Jardim Catarina',
            jardimcatarina: 'Jardim Catarina',
            jardimesperanca: 'Jardim Esperança',
            macae1: 'Macaé 1',
            macae2: 'Macaé 2',
            mage1: 'Magé 1',
            mage2: 'Magé 2',
            saojosedoimbassai: 'São José do Imbassaí',
            novacidade: 'Nova Cidade',
            riobonito1: 'Rio Bonito 1',
            riobonito2: 'Rio Bonito 2',
            riodoouro: 'Rio do Ouro',
            maracana: 'Maracanã',
            saopedrodaaldeia: 'São Pedro da Aldeia',
            tangua: 'Tanguá',
            trindade: 'Trindade',
            unamar: 'Unamar'
        };

        // Fallback: build a readable label from a key
        function humanizeKey(key) {
            if (LOJA_NAME_MAP[key]) return LOJA_NAME_MAP[key];
            // Insert spaces before numbers and between words, then capitalize
            const withSpaces = key
                .replace(/(\d+)/g, ' $1')
                .replace(/([a-z])([A-Z])/g, '$1 $2')
                .replace(/de|do|da|das|dos/gi, (m) => m.toLowerCase());
            return withSpaces
                .split(/\s|_/)
                .filter(Boolean)
                .map((w, i) => i === 0 ? (w.charAt(0).toUpperCase() + w.slice(1)) : w)
                .join(' ');
        }

        async function loadLojas() {
            try {
                const res = await fetch('./usuarios.txt', { cache: 'no-store' });
                if (!res.ok) throw new Error('Falha ao carregar usuarios.txt');
                const text = await res.text();
                const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);

                // Parse lines like "aguamineral:tag.agm" and keep only the keys
                let lojas = lines
                    .map(line => line.split(':')[0])
                    // Exclude admin lines
                    .filter(key => key && !/^adm/.test(key));

                // Map to display labels
                const lojaObjs = lojas.map(key => ({
                    key,
                    label: LOJA_NAME_MAP[key] || humanizeKey(key)
                }));

                // Sort alphabetically using pt-BR locale and accent sensitivity
                lojaObjs.sort((a, b) => a.label.localeCompare(b.label, 'pt-BR', { sensitivity: 'base' }));

                renderLojas(lojaObjs);

                // Hook up search
                const search = document.getElementById('search-lojas');
                search.addEventListener('input', () => {
                    const q = normalizeString(search.value || '');
                    const filtered = lojaObjs.filter(x => normalizeString(x.label).includes(q));
                    renderLojas(filtered);
                });
            } catch (err) {
                console.error(err);
                const ul = document.getElementById('lojas-list');
                if (ul) {
                    ul.innerHTML = '<li style="color:#ffb3b3">Erro ao carregar lojas</li>';
                }
            }
        }

        function renderLojas(items) {
            const ul = document.getElementById('lojas-list');
            if (!ul) return;
            ul.innerHTML = '';
            for (const item of items) {
                const li = document.createElement('li');
                li.textContent = item.label;
                ul.appendChild(li);
            }
        }

        // Delay run until DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadLojas);
        } else {
            loadLojas();
        }
    </script>
</body>

</html>